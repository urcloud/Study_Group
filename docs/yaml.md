# YAML이란?
* 타 시스템 간에 데이터를 주고 받을 때 데이터의 연동과 호환성을 위해 포맷에 대한 규칙이 필요함
ex) CSV, XML, JSON 등이 데이터 표현 양식의 한 종류
* 기존 웹에서는 XML과 JSON을 이용해 어떤 값들을 정의하고 사용해 왔지만, XML은 까다롭고 가독성도 좋지 않아 JSON 포매팅 방식으로 많이 이용되고 있음
* 그러나 JSON도 주석을 달 수 없고, 중괄호와 대괄호로 인해 코드 길이가 길어진다는 단점이 있음
* 이에 새로 생긴 포매팅 방식이 YAML/YML
* YAML 또한 가독성이 조금 더 높은 데이터 포맷(규칙)이 정의되어있는 파일 형식이라고 보면 됨
* 주석도 쓸 수 있고 문법이 간결한 편임
* Doker Compose, Kubernetes, Flutter, Spring boot 프로젝트에서 설정파일을 정의할때 자주 애용됨

## YAML과 YML의 차이점
* yaml과 yml 파일은 해석 및 구문이 동일함
* 옛날 windows에서 extensions는 파일 확장자가 3자로 제한되는 특성이 있었기 때문에 분리된 것 뿐
* html 대신 htm으로도 쓰였는데 이와 같은 원리
* 요즘은 확장자에 3글자를 넣어야하는 제한이 없으니 그냥 yaml 사용해도 됨

## JSON과 YAML
* JSON은 중괄호를 이용해 데이터간의 구분을 표현하지만, YAML은 띄어쓰기로 데이터 구분을 함
* 문법만 다르고 데이터를 표현하고자 함은 똑같음
* 대부분 웹에서 데이터 통신을 위해 JSON을 많이 사용하고, reference를 정의할 때 복잡한 object 구조를 표현하기 위해 YAML을 많이 사용함
* YAML 모델이 JSON보다 좀 더 복잡하기 때문에 파싱하고 생성하는데 YAML이 더 느림

---

# YAML 문법

## Key: Value
* key: value 형태로, key와 value를 콜론(:) 기준으로 구분하나, 콜론 뒤에 띄어쓰기를 해줘야 함
* 만약 콜론(:) 뒤에 공백이 없으면 하나의 String으로 인식되어 문법 오류가 나타남
* 데이터가 여러개 있어도 콤마를 쓰지 않고 바로 개행함

## 들여쓰기
* 들여쓰기로 계층 구조를 표현하기 때문에 들여쓰기가 매우 중요함
* 들여쓰기를 통해 포함관계를 표시함

## 따옴표
* 큰 따옴표, 작은 따옴표를 안써도 자동으로 숫자와 문자열로 인식이 됨
* 하지만 만약 : 가 들어간 문자열이면 무조건 따옴표로 둘러싸야함
```yaml
ex) string: "A:B"
```

* 이스케이프 문자(\t, \n 등)를 쓸 때 큰 따옴표로 묶어야 함
* 이스케이프 문자를 작은 따옴표로 묶으면 문자를 있는 그대로 인식함

## 배열
* 배열을 표현할 때 '-' 로 시작하는 하위 요소로 표현할 수 있음
* 이때 반드시 '-' 뒤에 띄어쓰기 해줘야 함
* '-' 대신 일반적인 배열 표현법 같이 대괄호[] 로 리스트를 한 줄로 표현도 가능함
* 단순한 값 리스트 나열이 아니라, 구조체의 리스트를 표현하고자 한다면 '-'과 key: value 구조를 이용해 객체를 포함한 배열을 표현 가능함
* 하나의 객체 원소면 '-'을 쓰지 않고 그대로 나열함

```yaml
ex) people: 
        - name: EX
          age: 25
        - name: EX2
          age: 24
```
* '-' 뒤에 key: value 구조가 오면 객체를 포함한 배열, 그냥 데이터가 바로 오면 단순 원소 배열임

## Boolean
* 데이터 부분에 yes, no, true, false를 지정하면 boolean값으로 인식됨
* 대문자 소문자를 가리지 않음
* 만약 yes나 no를 문자열 값으로 전달하고 싶으면 따옴표로 묶어줘야함

## 주석
* 파이썬과 같이 #으로 주석 표기 가능

## 변수
* 재사용하는 값 또는 구조체가 있을 경우, 변수와 비슷한 태그 기능이 있음
* &기호로 변수를 선언하고, *기호로 변수를 참조
* 반복되는 데이터 부분을 태그하고 참조하는 식으로 구성해 놓으면 가독성 높게 데이터를 구성할 수 있음

```py
ex) default: &default_info
        group: 'student'
        age: 25
        
    student:
        - name: ex1
          <<: *default_info
        - name: ex2
          <<: *default_info
```

## Multiple Documents
* 두 파일의 데이터를 하나의 파일로 포함시켜 표현해주는 기능을 제공해줌
* 한 파일에서 모든 configuration을 관리할 수 있음
* 스프링 프로젝트 환경이 dev냐 product 환경이냐에 따라 적용되는 옵션 값들이 다른 설정 프로퍼티 파일들을 yaml에서 - 3개를 이용해 두 옵션의 파일을 하나의 파일에 포함시켜 한번에 정의해줄 수 있음
* 여기저기 다른 파일을 탐색하지 않는게 좋아서 모아놓는게 편한 경우가 있을 것이고, 특정 환경 설정만 바꾸고 싶은데 똑같은 key가 환경별로 있어서 헷갈리는 경우가 있을 수도 있으므로 취향이나 가이드라인 따라 사용하면 됨

## application.properties vs yaml
* 스프링부트에서 properties는 애플리케이션의 설정을 정의하는 데 사용되는 설정 파일 형식
* 주로 키-값 형태로 구성되어 있으며, 이 키-값 쌍은 애플리케이션의 여러 가지 설정을 정의함
* properties 파일은 주로 간단한 키-값 형태의 설정을 다룰 때 사용된다. 설정이 크게 중첩되지 않고, 키-값 쌍으로 간단하게 표현할 수 있는 경우에 적합함
* yaml 파일은 계층적인 구조와 들여쓰기를 통해 복잡한 설정을 표현하기에 더 적합함
* 간단한 설정과 환경별 오버라이딩을 다룰 때는 properties 파일이 편리하며, 복잡한 계층 구조와 가독성을 중요시하는 복잡한 설정에는 yaml 파일이 더 적합함
* properties와 yaml을 함께 사용하면 properties 파일이 우선순위가 높아 yaml 파일에서 설정한 내용이 덮어씌워질 수 있다는 점 조심

## ddl-auto
* create
> 애플리케이션 시작 시 기존 테이블을 삭제하고 새로 생성함
>
> 개발 초기에 Entity를 계속 수정할 때, 데이터가 유지될 필요 없고, 매번 새로운 테스트 데이터를 사용하는 경우 사용
> 
DB에 저장된 데이터가 매번 삭제됨

* create-drop
> create처럼 시작 시 스키마를 생성하고, 애플리케이션 종료 시점에 스키마를 제거함
>
> 통합 테스트나 테스트 컨테이너 환경에서 유용하고, 종료 후 DB 정리까지 해주고 싶을 때 사용함
>
> 서버가 비정상 종료되면 drop되지 않을 수 있음

* update
> 기존 스키마를 유지하면서 필요한 경우에만 변경을 적용함
>
> 운영 전 테스트 환경(스테이징), 간단한 모델 변경을 반영할 때 사용
>
> 복잡한 스키마 변경은 반영되지 않고, 컬럼 삭제는 적용되지 않음. 실서비스에서 사용 시 예기치 못한 변경 위험 존재

* validate
> 엔티티와 DB 스키마가 정확히 일치하는지 검증만 하고, 변경은 하지 않음
>
> 운영 환경, 애플리케이션 시작 전에 DB 스키마와의 불일치 여부를 확인하고 싶을 때 사용
>
> 불일치 시 애플리케이션이 실행되지 않음


* 실무에서 추천 조합

| 환경       | 설정값                   | 이유                                                                 |
|------------|--------------------------|----------------------------------------------------------------------|
| 로컬 개발   | `create` 또는 `update`    | 개발 편의성을 위해 스키마 자동 생성 사용                                          |
| 테스트      | `create-drop`             | 테스트 종료 후 자동으로 테이블 제거 → 깔끔한 상태 유지                                   |
| 스테이징    | `update` 또는 `validate`  | 운영 환경과 유사하게 테스트하되, 필요 시 자동 반영 또는 검증 용도로 사용                        |
| 운영       | `validate` 또는 `none`    | 실수로 인한 스키마 변경 방지 + Flyway/Liquibase 등 스키마 버전 관리 도구와 함께 사용 권장         |

* ex) 테이블과 데이터가 유지되려면
> ddl-auto: create 설정 후 애플리케이션을 실행
  이때 DB에 테이블이 생성됨
> 
> 애플리케이션 종료 전 ddl-auto: update로 설정을 변경 
> 
> 다시 애플리케이션을 실행
  이때부터는 Hibernate가 기존 테이블을 건드리지 않고, 변경된 스키마만 반영함